<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billing - Retail Shop Pro</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="navbar-brand">üõí Retail Shop Pro</div>
            <div class="navbar-menu">
                <span id="userDisplay" style="color: var(--text-secondary);"></span>
                <a href="admin.html" class="btn btn-outline" id="homeButton"
                    style="text-decoration: none; margin-right: 0.5rem;" title="Go to Dashboard">
                    üè† Home
                </a>
                <button class="btn btn-outline" onclick="Auth.logout()">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container" style="padding-top: 2rem;">
        <div class="flex-between mb-3">
            <h1>Billing</h1>
            <button class="btn btn-danger" onclick="BillingManager.clearCart()">Clear Cart</button>
        </div>

        <div class="billing-layout">
            <!-- Left: Product Search & Cart -->
            <div>
                <!-- Customer Info -->
                <div class="glass-card mb-3">
                    <h3>Customer Information</h3>
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label class="form-label">Customer Name</label>
                            <input type="text" class="form-input" id="customerName" placeholder="Walk-in Customer">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-input" id="customerPhone" placeholder="Optional"
                                oninput="this.value = this.value.replace(/[^0-9+\-\s()]/g, '')">
                        </div>
                    </div>
                    <div class="form-group mt-2">
                        <label class="form-label">Bill Date</label>
                        <input type="date" class="form-input" id="billDate">
                    </div>
                    <div class="grid grid-2 mt-2">
                        <div class="form-group">
                            <label class="form-label">Bill To Address</label>
                            <textarea class="form-input" id="customerAddress" placeholder="Billing Address"
                                rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Delivery To Address (Optional)</label>
                            <textarea class="form-input" id="deliveryAddress"
                                placeholder="Delivery Address (if different)" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="grid grid-2 mt-2">
                        <div class="form-group">
                            <label class="form-label">GSTIN (Optional)</label>
                            <input type="text" class="form-input" id="customerGstin" placeholder="Customer GSTIN">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Transport Vehicle No. (Optional)</label>
                            <input type="text" class="form-input" id="transportVehicle" placeholder="Vehicle Number">
                        </div>
                    </div>

                    <div class="form-group mt-2">
                        <label class="form-label">Billing Notes (Optional)</label>
                        <textarea class="form-input" id="billingNotes" placeholder="Additional notes..."
                            rows="2"></textarea>
                    </div>
                </div>

                <!-- Product Search -->
                <div class="glass-card mb-3">
                    <h3>Add Products</h3>
                    <div class="product-search">
                        <input type="text" class="form-input" id="productSearch"
                            placeholder="Search products by name or category..." autocomplete="off">
                        <div id="searchResults" class="search-results hidden"></div>
                    </div>
                </div>

                <!-- Cart -->
                <div class="glass-card">
                    <h3>Cart Items</h3>
                    <div id="cartEmpty" class="text-center text-muted" style="padding: 2rem;">
                        <p style="font-size: 3rem; margin-bottom: 1rem;">üõí</p>
                        <p>Cart is empty. Search and add products to get started.</p>
                    </div>
                    <div id="cartItems"></div>
                </div>
            </div>

            <!-- Right: Bill Summary -->
            <div>
                <div class="glass-card" style="position: sticky; top: 100px;">
                    <h3>Bill Summary</h3>
                    <div id="billSummary" class="invoice-summary">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <strong>‚Çπ0.00</strong>
                        </div>
                        <div class="summary-row">
                            <span>CGST:</span>
                            <strong>‚Çπ0.00</strong>
                        </div>
                        <div class="summary-row">
                            <span>SGST:</span>
                            <strong>‚Çπ0.00</strong>
                        </div>
                        <div class="summary-row total">
                            <span>Total:</span>
                            <strong>‚Çπ0.00</strong>
                        </div>
                    </div>


                    <button class="btn btn-success mt-3" style="width: 100%;" onclick="BillingManager.generateBill()">
                        Generate Bill & Print
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/database.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/products.js"></script>
    <script src="js/billing.js"></script>
    <script src="js/pdf.js"></script>
    <script>
        // Check authentication
        Auth.requireLogin();

        // Display user info
        const user = Auth.getCurrentUser();
        document.getElementById('userDisplay').textContent = `Welcome, ${user.name}`;

        // Hide Home button for billing users (non-admin)
        if (user.role !== 'admin') {
            const homeButton = document.getElementById('homeButton');
            if (homeButton) {
                homeButton.style.display = 'none';
            }
        }

        // Initialize billing
        BillingManager.init();
    </script>
</body>

</html>